---
title: '更新推荐配置'
api: 'PUT /api/v1/site-svc-video-mgmt/recommend/config'
description: '更新推荐算法配置（用户行为权重或热度召回权重）'
---

## 接口概述

更新推荐算法的权重配置，**每次只能更新一种配置类型**：

| configType 值 | 更新内容 | 校验规则 |
|--------------|---------|---------|
| `user_behavior_weights` | 用户行为权重 | 6个字段必填 |
| `hot_weights` | 热度召回权重 | 3个字段必填，总和 = 1.0 |

<Warning>
  热度召回权重的所有值之和必须等于 **1.0**（允许 ±0.0001 误差），否则接口返回错误。
</Warning>

## 认证

<ParamField header="x-Token" type="string" required>
  JWT 认证令牌（用于识别更新人）
</ParamField>

<Note>
  更新人信息从 JWT 令牌中自动获取，无需在请求体中传递。
</Note>

## Request Body

<ParamField body="configType" type="string" required>
  配置类型：`user_behavior_weights` 或 `hot_weights`
</ParamField>

<ParamField body="value" type="object" required>
  配置值（JSON对象，支持小数）
</ParamField>

### User Behavior Weights

当 `configType = "user_behavior_weights"` 时，value 必须包含：

| 字段 | 类型 | 说明 |
|------|------|------|
| view_valid | number | 有效观看得分 |
| view_complete | number | 完播得分 |
| like | number | 点赞得分 |
| favorite | number | 收藏得分 |
| share | number | 分享得分 |
| pay | number | 付款得分 |

### Hot Weights

当 `configType = "hot_weights"` 时，value 必须包含（总和 = 1.0）：

| 字段 | 类型 | 说明 |
|------|------|------|
| like | number | 点赞权重 |
| share | number | 分享权重 |
| favorite | number | 收藏权重 |

## Response

<ResponseField name="code" type="int" required>
  业务状态码：`0` 成功，`40001` 参数错误，`50001` 服务器错误
</ResponseField>

<ResponseField name="data" type="object">
  更新后的配置数据
</ResponseField>

<ResponseField name="msg" type="string" required>
  响应消息
</ResponseField>

<RequestExample>

```json 用户行为权重
{
  "configType": "user_behavior_weights",
  "value": {
    "view_valid": 1,
    "view_complete": 3,
    "like": 5,
    "favorite": 8,
    "share": 10,
    "pay": 20
  }
}
```

```json 热度召回权重
{
  "configType": "hot_weights",
  "value": {
    "like": 0.5,
    "share": 0.3,
    "favorite": 0.2
  }
}
```

</RequestExample>

<ResponseExample>

```json 成功响应
{
  "code": 0,
  "data": {
    "configType": "user_behavior_weights",
    "value": {
      "view_valid": 1,
      "view_complete": 3,
      "like": 5,
      "favorite": 8,
      "share": 10,
      "pay": 20
    }
  },
  "msg": "更新推荐配置成功"
}
```

```json 热度权重总和错误
{
  "code": 50001,
  "msg": "hot weights sum must equal 1.0"
}
```

```json 缺少必填字段
{
  "code": 50001,
  "msg": "invalid user behavior weights: missing required field: view_valid"
}
```

</ResponseExample>

## Error Codes

| 错误码 | 含义 | HTTP状态码 |
|--------|------|-----------|
| 0 | 成功 | 200 |
| TOKEN_NOT_FOUND | 未提供认证令牌 | 401 |
| TOKEN_EXPIRED | 认证令牌已过期 | 401 |
| INVALID_TOKEN | 认证令牌无效 | 401 |
| 40001 | 参数验证失败 | 400 |
| 50001 | 服务器内部错误 | 500 |

## 代码示例

<CodeGroup>

```javascript JavaScript
async function updateConfig(configType, value) {
  const response = await fetch('/api/v1/site-svc-video-mgmt/recommend/config', {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'x-Token': 'YOUR_JWT_TOKEN'
    },
    body: JSON.stringify({ configType, value })
  });

  const result = await response.json();
  if (result.code !== 0) {
    throw new Error(result.msg);
  }
  return result.data;
}

// 热度权重前端校验
function validateHotWeights(like, share, favorite) {
  const sum = like + share + favorite;
  return Math.abs(sum - 1.0) <= 0.0001;
}
```

```bash cURL
curl -X PUT https://dev-admin.beauty-666.com/api/v1/site-svc-video-mgmt/recommend/config \
  -H "Content-Type: application/json" \
  -H "x-Token: YOUR_JWT_TOKEN" \
  -d '{
    "configType": "hot_weights",
    "value": { "like": 0.5, "share": 0.3, "favorite": 0.2 }
  }'
```

</CodeGroup>

## 注意事项

<Note>
  配置更新后**立即生效**，无需重启服务。
</Note>

<Tip>
  热度权重更新前，建议前端先校验总和是否为 1.0，避免无效请求。
</Tip>
